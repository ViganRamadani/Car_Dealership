
<div class="News">
    <h1 class="title">Create News</h1>
    <form id="form" method="POST" enctype="multipart/form-data">
        <input id="title" type="text" placeholder="Title" required /><br />
        @* <input id="description" type="text" placeholder="Description" required /><br />*@
        <input class="description" id="description" type="text" placeholder="Description" required /><br />
        <input type="file" name="image" id="fileUpload"  required /><br />
        <button type="submit" class="btn btn-primary">Submit</button>
       
    </form>
</div>
<style>
   h1.title{
       text-align:center;
       padding-top:23px;
   }
    .News {
        box-shadow: 10px 10px 5px #aaaaaa;
        background-color: lightgray;
        border-radius: 5px;
        width:100%;
        height:50%;
        margin-top:113px;
    }
    form {
        border-radius: 5px;
        border: 1px gray;
       
        text-align: center;
        
    }
    input#title{    
        width: 70%;
        border-radius: 5px;
        height:40px;
        border:1px solid lightgray;
        margin-top: 32px;
        text-align: center;
    }
    .description {
        width: 70%;
        border-radius: 5px;
        height: 40px;
        border: 1px solid lightgray;
        margin-top: 32px;
        text-align: center;
    }
    input#fileUpload {
        cursor: pointer;
        width: 70%;
        height: 30px;
        border-radius: 5px;
        background-color: white;
        margin-top: 32px;
        text-align: center;
    }
    
    button {
        width: 60%;
        margin-top: 32px;
        margin-bottom: 32px;
        height: 40px;
        border-radius: 25px;
        background-color: lightgreen;
    }
</style>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    $("input").change(function (e) {

        for (var i = 0; i < e.originalEvent.srcElement.files.length; i++) {

            var file = e.originalEvent.srcElement.files[i];

            var img = document.createElement("img");
            var reader = new FileReader();
            reader.onloadend = function () {
                img.src = reader.result;
            }
            reader.readAsDataURL(file);
            $("input").after(img);
        }
    });
  var formData = new FormData();

  $( 'form' ).submit( ( e ) => {
    jQuery.each( jQuery( '#fileUpload' )[ 0 ].files, function ( i, file ) {
@*        formData.append('file', file);*@
        formData.set('file', file);

    } );
    $.ajax( {
      type: 'POST',
      url: 'http://localhost:3000/user/createPhoto',
      data: formData,
      contentType: false,
      processData: false,
      success: function ( result ) {
        if ( result.status != 0 ) {
          const newsData = {
            title: $( "#title" ).val(),
            description: $( "#description" ).val(),
            img_path: result.file.filename
          };


          //console.log(result.file.filename)

          $.ajax( {
            type: 'POST',
            url: 'http://localhost:3000/user/createNews',
            data: newsData,
            dataType: "json",
            encode: true,
            success: function ( result ) {
              if ( result.status != 0 ) {
                console.log( result )
                return ;
              }
              console.log( result )
            }
          } );
          }
      }
    } );

      e.preventDefault();
      @*location.reload(true);*@
      @*alert("News was uploaded successfully "+location.reload(true));*@
      @*alert(location.hostname);*@
  })

</script>
