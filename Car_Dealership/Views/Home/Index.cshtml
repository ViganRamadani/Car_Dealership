@model Car_Dealership.Models.News
@{
    ViewData["Title"] = "Home Page";
}
<div class="home-background">
    <div class="home-title">
        <h1 class="display-4">Welcome</h1>
        <p>The right place to find the right car</p>
    </div>
</div>

<div class="container">

    <br />
    <h1 class="mt-4" style="text-align:center">LATEST CARS</h1>
    <br />

    @for (int i = 0; i < 1; i++)
    {
        <div class="row mt-2">
            <div class="col-md-4">
                <div class="card latest-cars">
                    <img class="card-img-top" src="/img/Gclass.jpg">
                    <div class="card-body">
                        <h5 class="card-title">G-Class</h5>
                        <p class="card-text">$60.000</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card latest-cars">
                    <img class="card-img-top" src="/img/audi.jpg">
                    <div class="card-body">
                        <h5 class="card-title">AUDI SQ8 4.0 TFSI QUATTRO</h5>
                        <p class="card-text">$50.000</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card latest-cars">
                    <img class="card-img-top" src="/img/mercedes.jpg">
                    <div class="card-body">
                        <h5 class="card-title">S 400 D LONG 4MATIC AMG-LINE</h5>
                        <p class="card-text">$35.000</p>
                    </div>
                </div>
            </div>
        </div>
    }

    <div id="result"></div>
    <button type="button" class="btn btn-primary btn-block" id="allNews" onclick="ajaxGet()">click to view all news.</button>

    <div id="contain">

        <div id="reportWindow">

        </div>
    </div>

    <div class="container">
        <div class="d-flex flex-row justify-content-center justify-content-around brands-logo">
            <div class="logo-box">
                <img src="~/img/mercedes.png" alt="Mercedes-Benz">
            </div>
            <div class="logo-box">
                <img src="img/bmw.png" alt="BMW">
            </div>
            <div class="logo-box">
                <img src="img/audi.png" alt="Audi">
            </div>
            <div class="logo-box">
                <img src="img/lambo.png" alt="Lamborghini">
            </div>
            <div class="logo-box">
                <img src="img/volkswagen.png" alt="Volkswagen">
            </div>
            <div class="logo-box">
                <img src="img/porsche.jpg" alt="Porsche">
            </div>
        </div>
    </div>
    <div class="containter">
        <h1 class="our-services" style="text-align:center">OUR SERVICES</h1>
        <div class="d-flex flex-row justify-content-center justify-content-around">
            <div class="col-md-4 text-center mb-5">
                <i class="fas fa-tools fa-5x mt-3 mb-3"></i>
                <h4>Repair</h4>
            </div>
            <div class="col-md-4 text-center">
                <i class="fas fa-truck-loading fa-5x mt-3 mb-3"></i>
                <h4>Car Transport</h4>
            </div>
            <div class="col-md-4 text-center">
                <i class="fas fa-truck-loading fa-5x mt-3 mb-3"></i>
                <h4>Replacement Part</h4>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script type='text/javascript'>

    function ajaxGet() {

        $.ajax({
            type: "GET",
            url: "http://localhost:3000/user/allNews",
            success: function (result) {

                $.each(result, function (key, value) {
                    @* alert("Title: " + result[key].title + "; Description: " + result[key].description + ";");*@
                    console.log(result[key].image);
                });
                $.each(result, function (index, obj) {
                    var tr = $("<div></div>");

                    tr.append("<p>" + obj.title + "</p>");
                    tr.append("<p>" + obj.description + "</p>");
                    tr.append("<p>" + obj.img_path + "</p>");
                    tr.append("<p>" + obj.createdAt + "</p><hr>");
                    tr.append("<button value=" + obj._id + " onclick=showReportWindow(this)>Report</button><hr>");

                    $("#contain").append(tr);
                });
                @*if (results.length > 0) {
                    $('#title').text(result[0].title);
                    $('#description').text(result[0].description);
                    $('#img_path').text(result[0].img_path);
                }
                else {
                    alert("No data.");
                }*@
                console.log("Success: ", result);
            },
            error: function (e) {
                $("#getResultDiv").html("Error");
                console.log("ERROR: ", e);
            }
        });
    }

    function showReportWindow(data) {
        var id = $(data).val();
        var element = $("<form method='POST' class='d-flex flex-column'></form>");

        element.append("<h4>" + id + "</h4>");
        //element.append("<input placeholder='Report Reason'></input>");

        var select = $("<select class='mb-3 mt-3'></select>")

        select.append("<option>test</option>")
        select.append("<option>test</option>")
        select.append("<option>test</option>")
        select.append("<option>test</option>")
        select.append("<option>test</option>")
        element.append(select)
        element.append("<button type='button' value=" + id +" class='btn btn-danger' onclick='reportNews(this);'>Create Report</input>");

        $("#reportWindow").append(element);

        $("#reportWindow").css({ "opacity": "100%", "pointer-events": "all", "z-index": 1});

        //opacity: 0;
        //pointer - events: none;
        //z - index: 0;
    }

    function reportNews(data) {
        var id = $(data).val();
        var select = $("select :selected").val();
        console.log(id, select);
        var obj = {
            newsId: id,
            reportReason: select
        }
      $.ajax({
          type: "POST",
          url: 'http://localhost:3000/user/report_news/' + id,
          data: obj,
          dataType: "json",
            encode: true,
            success: function (result) {
                console.log(result);
                //location.reload(true);
                $("#reportWindow").css({ "opacity": "0", "pointer-events": "none", "z-index": -1 });
                $('form').remove();
            }
      });


    }

    function removenews(data) {
        var id = $(data).val();
        console.log(id);
        $.ajax({
            type: "DELETE",
            url: 'http://localhost:3000/user/remove_news/' + id,
            success: function (result) {
                console.log(result);
                location.reload(true);
            }
        });
    }
</script>

<style>
    * {
        box-sizing: border-box;
    }

    .left-side img {
        width: 350px;
    }

    .right-side {
        float: right;
    }

        .right-side p {
            min-width: 150px;
        }

    #reportWindow {
        position: absolute;
        background: white;
        display: flex;
        align-items: center;
        width: 75%;
        height: 350px;
        opacity: 0;
        pointer-events: none;
        z-index: 0;
        transition: opacity 0.2s;
    }

    @@media screen and (max-width: 1213px) {
        .right-side {
            float: right;
        }
    }

    @@media screen and (max-width: 770px) {
        .left-side {
            margin: 0 auto;
        }

        .right-side {
            text-align: center;
        }
    }

    @@media screen and (max-width: 365px) {
        .left-side img {
            width: 250px;
            margin: 0 auto;
            min-width: 200px;
        }
    }

    #app {
        background-color: lightgray;
    }
</style>


